{"version":3,"file":"fetch2.js","sources":["../node_modules/rollup-plugin-node-globals/src/global.js","../src/index.js"],"sourcesContent":["export default typeof global !== \"undefined\" ? global :\n            typeof self !== \"undefined\" ? self :\n            typeof window !== \"undefined\" ? window : {}\n","\r\nvar _self = (typeof self === 'object' && self.self === self) && self\r\nvar _global = (typeof global === 'object' && global.global === global) && global\r\nvar root = _self || _global\r\n\r\nvar Fetch = root.fetch || null\r\nvar FormData = root.FormData\r\n\r\n// 构造字符串body\r\nfunction ObjToUrlParams (obj) {\r\n  var urlstr = ''\r\n  for (var key in obj) {\r\n    if (urlstr) urlstr += '&'\r\n    urlstr += key + '=' + obj[key]\r\n  }\r\n  return urlstr\r\n}\r\n\r\nfunction Fetch2 () {}\r\n\r\nFetch2.prototype.request = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\nFetch2.prototype.response = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n* 3xx-5xx responses are NOT network errors, and should be handled in then()\r\n**/\r\nFetch2.prototype.fetch = function (uri, method, options = {}) {\r\n  var that = this\r\n  method = method ? method.toUpperCase() : 'GET'\r\n  // Request with GET/HEAD method cannot have body.\r\n  if (method === 'GET' || method === 'HEAD') {\r\n    delete options.body\r\n  }\r\n  var isTransion = (typeof options.body === 'object') && !(options.body instanceof FormData)\r\n  // 对于formData数据，并不需要指定Content-Type\r\n  if (isTransion || typeof options.body === 'string') {\r\n    if (!options.headers) options.headers = {}\r\n    options.headers['Content-Type'] = 'application/x-www-form-urlencoded'\r\n  }\r\n  if (isTransion) {\r\n    options.body = ObjToUrlParams(options.body)\r\n  }\r\n  // var opts = Object.assign({}, {method}, options)\r\n  options.method = method\r\n  var opts = options\r\n  return new Promise((resolve, reject) => {\r\n    function request () {\r\n      // 响应过滤器\r\n      function response (res) {\r\n        var interceptors = that.response.interceptors\r\n        if (interceptors.length === 0) {\r\n          resolve(res)\r\n          return true\r\n        }\r\n        var v = 0\r\n        function run () {\r\n          if (v >= interceptors.length) {\r\n            resolve(res)\r\n            return true\r\n          }\r\n          var interceptor = interceptors[v]\r\n          v++\r\n          if (interceptor && typeof interceptor === 'function') {\r\n            interceptor(res, run)\r\n          }\r\n        }\r\n        run()\r\n      }\r\n      Fetch(uri, opts).then(res => {\r\n        switch (options.type) {\r\n          case 'text':\r\n            res.text().then(text => {\r\n              res.data = text\r\n              response(res)\r\n            })\r\n            break\r\n          case 'blob':\r\n            res.blob().then(blob => {\r\n              res.data = blob\r\n              response(res)\r\n            })\r\n            break\r\n          case 'arrayBuffer':\r\n            res.arrayBuffer().then(buffer => {\r\n              res.data = buffer\r\n              response(res)\r\n            })\r\n            break\r\n          default:\r\n            res.json().then(json => {\r\n              res.data = json\r\n              response(res)\r\n            }).catch(err => reject(err))\r\n        }\r\n      }).catch(err => {\r\n        reject(err)\r\n      })\r\n    }\r\n    var interceptors = that.request.interceptors\r\n    if (interceptors.length === 0) {\r\n      request()\r\n      return true\r\n    }\r\n    var v = 0\r\n    function run () {\r\n      if (v >= interceptors.length) {\r\n        request()\r\n        return true\r\n      }\r\n      var interceptor = interceptors[v]\r\n      v++\r\n      if (interceptor && typeof interceptor === 'function') {\r\n        interceptor(opts, run)\r\n      }\r\n    }\r\n    run()\r\n  })\r\n}\r\n\r\n// for node-fetch\r\nFetch2.prototype.init = function (fetch, formData) {\r\n  Fetch = fetch\r\n  FormData = formData\r\n}\r\n\r\nFetch2.prototype.Fetch2 = Fetch2\r\n\r\nFetch2.prototype.get = function (uri, options) {\r\n  return this.fetch(uri, 'GET', options)\r\n}\r\n\r\nFetch2.prototype.post = function (uri, options) {\r\n  return this.fetch(uri, 'POST', options)\r\n}\r\n\r\nFetch2.prototype.put = function (uri, options) {\r\n  return this.fetch(uri, 'PUT', options)\r\n}\r\n\r\nFetch2.prototype.delete = function (uri, options) {\r\n  return this.fetch(uri, 'DELETE', options)\r\n}\r\n\r\nFetch2.prototype.head = function (uri, options) {\r\n  return this.fetch(uri, 'HEAD', options)\r\n}\r\n\r\nFetch2.prototype.patch = function (uri, options) {\r\n  return this.fetch(uri, 'PATCH', options)\r\n}\r\n\r\nvar fetch2 = new Fetch2()\r\n\r\nexport default fetch2\r\n"],"names":["_self","self","_global","global","root","Fetch","fetch","FormData","ObjToUrlParams","obj","urlstr","key","Fetch2","prototype","request","fn","warn","interceptors","push","response","uri","method","options","that","toUpperCase","body","isTransion","babelHelpers.typeof","headers","opts","Promise","resolve","reject","res","length","v","run","interceptor","then","type","text","data","blob","arrayBuffer","buffer","json","catch","err","init","formData","get","post","put","delete","head","patch","fetch2"],"mappings":"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"}