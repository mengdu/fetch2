{"version":3,"file":"fetch2.js","sources":["../src/index.js","../node_modules/rollup-plugin-node-globals/src/global.js"],"sourcesContent":["\r\nvar _self = (typeof self === 'object' && self.self === self) && self\r\nvar _global = (typeof global === 'object' && global.global === global) && global\r\nvar root = _self || _global\r\n\r\nvar Fetch = root.fetch || null\r\nvar FormData = root.FormData\r\n\r\n// 构造字符串body\r\nfunction ObjToUrlParams (obj) {\r\n  var urlstr = ''\r\n  for (var key in obj) {\r\n    if (urlstr) urlstr += '&'\r\n    urlstr += key + '=' + obj[key]\r\n  }\r\n  return urlstr\r\n}\r\n\r\nfunction Fetch2 () {}\r\n\r\nFetch2.prototype.request = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\nFetch2.prototype.response = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n* 3xx-5xx responses are NOT network errors, and should be handled in then()\r\n**/\r\nFetch2.prototype.fetch = function (uri, method, options = {}) {\r\n  var that = this\r\n  method = method ? method.toUpperCase() : 'GET'\r\n  // Request with GET/HEAD method cannot have body.\r\n  if (method === 'GET' || method === 'HEAD') {\r\n    delete options.body\r\n  }\r\n  var isTransion = (typeof options.body === 'object') && !(options.body instanceof FormData)\r\n  // 对于formData数据，并不需要指定Content-Type\r\n  if (isTransion || typeof options.body === 'string') {\r\n    if (!options.headers) options.headers = {}\r\n    options.headers['Content-Type'] = 'application/x-www-form-urlencoded'\r\n  }\r\n  if (isTransion) {\r\n    options.body = ObjToUrlParams(options.body)\r\n  }\r\n  // var opts = Object.assign({}, {method}, options)\r\n  options.method = method\r\n  var opts = options\r\n  return new Promise((resolve, reject) => {\r\n    function request () {\r\n      // 响应过滤器\r\n      function response (res) {\r\n        var interceptors = that.response.interceptors\r\n        if (interceptors.length === 0) {\r\n          resolve(res)\r\n          return true\r\n        }\r\n        var v = 0\r\n        function run () {\r\n          if (v >= interceptors.length) {\r\n            resolve(res)\r\n            return true\r\n          }\r\n          var interceptor = interceptors[v]\r\n          v++\r\n          if (interceptor && typeof interceptor === 'function') {\r\n            interceptor(res, run)\r\n          }\r\n        }\r\n        run()\r\n      }\r\n      Fetch(uri, opts).then(res => {\r\n        switch (options.type) {\r\n          case 'text':\r\n            res.text().then(text => {\r\n              res.data = text\r\n              response(res)\r\n            })\r\n            break\r\n          case 'blob':\r\n            res.blob().then(blob => {\r\n              res.data = blob\r\n              response(res)\r\n            })\r\n            break\r\n          case 'arrayBuffer':\r\n            res.arrayBuffer().then(buffer => {\r\n              res.data = buffer\r\n              response(res)\r\n            })\r\n            break\r\n          default:\r\n            res.json().then(json => {\r\n              res.data = json\r\n              response(res)\r\n            }).catch(err => reject(err))\r\n        }\r\n      }).catch(err => {\r\n        reject(err)\r\n      })\r\n    }\r\n    var interceptors = that.request.interceptors\r\n    if (interceptors.length === 0) {\r\n      request()\r\n      return true\r\n    }\r\n    var v = 0\r\n    function run () {\r\n      if (v >= interceptors.length) {\r\n        request()\r\n        return true\r\n      }\r\n      var interceptor = interceptors[v]\r\n      v++\r\n      if (interceptor && typeof interceptor === 'function') {\r\n        interceptor(opts, run)\r\n      }\r\n    }\r\n    run()\r\n  })\r\n}\r\n\r\n// for node-fetch\r\nFetch2.prototype.init = function (fetch, formData) {\r\n  Fetch = fetch\r\n  FormData = formData\r\n}\r\n\r\nFetch2.prototype.Fetch2 = Fetch2\r\n\r\nFetch2.prototype.get = function (uri, options) {\r\n  return this.fetch(uri, 'GET', options)\r\n}\r\n\r\nFetch2.prototype.post = function (uri, options) {\r\n  return this.fetch(uri, 'POST', options)\r\n}\r\n\r\nFetch2.prototype.put = function (uri, options) {\r\n  return this.fetch(uri, 'PUT', options)\r\n}\r\n\r\nFetch2.prototype.delete = function (uri, options) {\r\n  return this.fetch(uri, 'DELETE', options)\r\n}\r\n\r\nFetch2.prototype.head = function (uri, options) {\r\n  return this.fetch(uri, 'HEAD', options)\r\n}\r\n\r\nFetch2.prototype.patch = function (uri, options) {\r\n  return this.fetch(uri, 'PATCH', options)\r\n}\r\n\r\nvar fetch2 = new Fetch2()\r\n\r\nexport default fetch2\r\n","export default typeof global !== \"undefined\" ? global :\n            typeof self !== \"undefined\" ? self :\n            typeof window !== \"undefined\" ? window : {}\n"],"names":["ObjToUrlParams","obj","urlstr","key","Fetch2","global","self","window","_self","_global","root","Fetch","fetch","FormData","prototype","request","fn","warn","interceptors","push","response","uri","method","options","that","this","toUpperCase","body","isTransion","babelHelpers.typeof","headers","opts","Promise","resolve","reject","res","run","v","length","interceptor","then","type","text","data","blob","arrayBuffer","buffer","json","catch","err","init","formData","get","post","put","delete","head","patch"],"mappings":"kLASA,SAASA,EAAgBC,OACnBC,EAAS,OACR,IAAIC,KAAOF,EACVC,IAAQA,GAAU,QACZC,EAAM,IAAMF,EAAIE,UAErBD,EAGT,SAASE,KClBT,MAAiC,oBAAXC,OAAyBA,OACnB,oBAATC,KAAuBA,KACZ,oBAAXC,OAAyBA,sNDDxCC,65BAAyB,gCAATF,mBAAAA,QAAqBA,KAAKA,OAASA,MAASA,MAC5DG,EAA6B,qBAAXJ,gBAAAA,KAAuBA,EAAOA,SAAWA,GAAWA,EACtEK,EAAOF,GAASC,EAEhBE,EAAQD,EAAKE,OAAS,KACtBC,EAAWH,EAAKG,gBAcpBT,EAAOU,UAAUC,sCAEVC,SACe,mBAAPA,WACDC,KAAK,wCACN,SAEJC,aAAaC,KAAKH,IAChB,KAIXZ,EAAOU,UAAUM,uCAEVJ,SACe,mBAAPA,WACDC,KAAK,wCACN,SAEJC,aAAaC,KAAKH,IAChB,KAOXZ,EAAOU,UAAUF,MAAQ,SAAUS,EAAKC,OAAQC,4DAC1CC,EAAOC,KAGI,WAFNH,EAASA,EAAOI,cAAgB,QAEN,SAAXJ,UACfC,EAAQI,SAEbC,EAAsC,WAAxBC,EAAON,EAAQI,SAAwBJ,EAAQI,gBAAgBd,IAE7Ee,GAAsC,iBAAjBL,EAAQI,QAC1BJ,EAAQO,UAASP,EAAQO,cACtBA,QAAQ,gBAAkB,qCAEhCF,MACMD,KAAO3B,EAAeuB,EAAQI,SAGhCL,OAASA,MACbS,EAAOR,SACJ,IAAIS,QAAQ,SAACC,EAASC,YAClBnB,aAEEK,EAAUe,YAORC,OACHC,GAAKnB,EAAaoB,gBACZH,IACD,MAELI,EAAcrB,EAAamB,OAE3BE,GAAsC,mBAAhBA,KACZJ,EAAKC,OAdjBlB,EAAeM,EAAKJ,SAASF,gBACL,IAAxBA,EAAaoB,gBACPH,IACD,MAELE,EAAI,QAcJhB,EAAKU,GAAMS,KAAK,mBACZjB,EAAQkB,UACT,SACCC,OAAOF,KAAK,cACVG,KAAOD,IACFP,eAGR,SACCS,OAAOJ,KAAK,cACVG,KAAOC,IACFT,eAGR,gBACCU,cAAcL,KAAK,cACjBG,KAAOG,IACFX,qBAIPY,OAAOP,KAAK,cACVG,KAAOI,IACFZ,KACRa,MAAM,mBAAOd,EAAOe,QAE1BD,MAAM,cACAC,cASFb,OACHC,GAAKnB,EAAaoB,mBAEb,MAELC,EAAcrB,EAAamB,OAE3BE,GAAsC,mBAAhBA,KACZR,EAAMK,OAdlBlB,EAAeM,EAAKT,QAAQG,gBACJ,IAAxBA,EAAaoB,mBAER,MAELD,EAAI,SAiBZjC,EAAOU,UAAUoC,KAAO,SAAUtC,EAAOuC,KAC/BvC,IACGuC,GAGb/C,EAAOU,UAAUV,OAASA,EAE1BA,EAAOU,UAAUsC,IAAM,SAAU/B,EAAKE,UAC7BE,KAAKb,MAAMS,EAAK,MAAOE,IAGhCnB,EAAOU,UAAUuC,KAAO,SAAUhC,EAAKE,UAC9BE,KAAKb,MAAMS,EAAK,OAAQE,IAGjCnB,EAAOU,UAAUwC,IAAM,SAAUjC,EAAKE,UAC7BE,KAAKb,MAAMS,EAAK,MAAOE,IAGhCnB,EAAOU,UAAUyC,OAAS,SAAUlC,EAAKE,UAChCE,KAAKb,MAAMS,EAAK,SAAUE,IAGnCnB,EAAOU,UAAU0C,KAAO,SAAUnC,EAAKE,UAC9BE,KAAKb,MAAMS,EAAK,OAAQE,IAGjCnB,EAAOU,UAAU2C,MAAQ,SAAUpC,EAAKE,UAC/BE,KAAKb,MAAMS,EAAK,QAASE,IAGrB,IAAInB"}