{"version":3,"file":"fetch2.js","sources":["../node_modules/rollup-plugin-node-globals/src/global.js","../src/url-params.js","../src/index.js"],"sourcesContent":["export default typeof global !== \"undefined\" ? global :\n            typeof self !== \"undefined\" ? self :\n            typeof window !== \"undefined\" ? window : {}\n","/**\r\n* 判断一些原生对象\r\n**/\r\nfunction isOriginObject (obj) {\r\n  return obj.constructor === Date ||\r\n  obj instanceof HTMLElement ||\r\n  typeof obj === 'function' ||\r\n  obj.constructor === Blob ||\r\n  obj.constructor === File\r\n}\r\n\r\nfunction isArr (val) {\r\n  return Object.prototype.toString.call(val) === '[object Array]'\r\n}\r\n\r\n/**\r\n* 把参数对象序列化成树对象\r\n*\r\n**/\r\nfunction ObjTree (obj) {\r\n  var arr = []\r\n  for (var key in obj) {\r\n    // 过滤一些原生对象类型\r\n    if (isOriginObject(obj[key])) {\r\n      continue\r\n    }\r\n    if (typeof obj[key] === 'object') {\r\n      arr.push({label: key, child: ObjTree(obj[key])})\r\n    } else {\r\n      arr.push({label: key, val: obj[key]})\r\n    }\r\n  }\r\n  return arr\r\n}\r\n/**\r\n* 从对象树种遍历所有路径，及叶子\r\n*\r\n**/\r\nfunction ObjTreePaths (tree) {\r\n  var arr = []\r\n  // 路径遍历\r\n  function path (tree, label) {\r\n    label = label || ''\r\n    for (var i in tree) {\r\n      if (tree[i].child) {\r\n        if (label) {\r\n          path(tree[i].child, label + '[' + tree[i].label + ']')\r\n        } else {\r\n          path(tree[i].child, tree[i].label)\r\n        }\r\n      } else {\r\n        // 把叶子值连接到路径后面\r\n        if (label) {\r\n          arr.push(label + '[' + tree[i].label + ']=' + tree[i].val)\r\n        } else {\r\n          arr.push(tree[i].label + '=' + tree[i].val)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  path(tree)\r\n  return arr\r\n}\r\n\r\nfunction URLParams (obj, encode) {\r\n  if (typeof obj === 'object' && !isOriginObject(obj) && !isArr(obj)) {\r\n    var paths = ObjTreePaths(ObjTree(obj))\r\n    var qs = paths.join('&')\r\n    return encode ? encodeURI(qs) : qs\r\n  }\r\n  return ''\r\n}\r\n\r\nexport default {\r\n  url: (url, obj, encode) => {\r\n    var params = URLParams(obj, encode)\r\n    if (url.indexOf('?') > -1) {\r\n      var uri = url.split('?')\r\n      return params ? (url.replace(/&$/, '') + (uri[1] ? '&' : '') + params) : url\r\n    } else {\r\n      return params ? url + '?' + params : url\r\n    }\r\n  },\r\n  stringify: (obj, encode) => {\r\n    return URLParams(obj, encode)\r\n  }\r\n}\r\n","import URLParams from './url-params'\r\nvar _self = (typeof self === 'object' && self.self === self) && self\r\nvar _global = (typeof global === 'object' && global.global === global) && global\r\nvar root = _self || _global\r\n\r\nvar Fetch = root.fetch || null\r\nvar FormData = root.FormData\r\n\r\n\r\nfunction Fetch2 () {}\r\n\r\nFetch2.prototype.request = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\nFetch2.prototype.response = {\r\n  interceptors: [],\r\n  use (fn) {\r\n    if (typeof fn !== 'function') {\r\n      console.warn('the interceptors must be a function')\r\n      return false\r\n    }\r\n    this.interceptors.push(fn)\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n* 3xx-5xx responses are NOT network errors, and should be handled in then()\r\n**/\r\nFetch2.prototype.fetch = function (uri, method, options = {}) {\r\n  var that = this\r\n  method = method ? method.toUpperCase() : 'GET'\r\n  // Request with GET/HEAD method cannot have body.\r\n  if (method === 'GET' || method === 'HEAD') {\r\n    delete options.body\r\n  }\r\n  var isTransion = (typeof options.body === 'object') && !(options.body instanceof FormData)\r\n  // 对于formData数据，并不需要指定Content-Type\r\n  if (isTransion || typeof options.body === 'string') {\r\n    if (!options.headers) options.headers = {}\r\n    options.headers['Content-Type'] = 'application/x-www-form-urlencoded'\r\n  }\r\n  if (isTransion) {\r\n    options.body = URLParams.stringify(options.body)\r\n  }\r\n  // var opts = Object.assign({}, {method}, options)\r\n  options.method = method\r\n  var opts = options\r\n  return new Promise((resolve, reject) => {\r\n    function request () {\r\n      // 响应过滤器\r\n      function response (res) {\r\n        var interceptors = that.response.interceptors\r\n        if (interceptors.length === 0) {\r\n          resolve(res)\r\n          return true\r\n        }\r\n        var v = 0\r\n        function run () {\r\n          if (v >= interceptors.length) {\r\n            resolve(res)\r\n            return true\r\n          }\r\n          var interceptor = interceptors[v]\r\n          v++\r\n          if (interceptor && typeof interceptor === 'function') {\r\n            interceptor(res, run)\r\n          }\r\n        }\r\n        run()\r\n      }\r\n      var url = URLParams.url(uri, opts.params)\r\n      Fetch(url, opts).then(res => {\r\n        switch (options.type) {\r\n          case 'text':\r\n            res.text().then(text => {\r\n              res.data = text\r\n              response(res)\r\n            })\r\n            break\r\n          case 'blob':\r\n            res.blob().then(blob => {\r\n              res.data = blob\r\n              response(res)\r\n            })\r\n            break\r\n          case 'arrayBuffer':\r\n            res.arrayBuffer().then(buffer => {\r\n              res.data = buffer\r\n              response(res)\r\n            })\r\n            break\r\n          default:\r\n            res.json().then(json => {\r\n              res.data = json\r\n              response(res)\r\n            }).catch(err => reject(err))\r\n        }\r\n      }).catch(err => {\r\n        reject(err)\r\n      })\r\n    }\r\n    var interceptors = that.request.interceptors\r\n    if (interceptors.length === 0) {\r\n      request()\r\n      return true\r\n    }\r\n    var v = 0\r\n    function run () {\r\n      if (v >= interceptors.length) {\r\n        request()\r\n        return true\r\n      }\r\n      var interceptor = interceptors[v]\r\n      v++\r\n      if (interceptor && typeof interceptor === 'function') {\r\n        interceptor(opts, run)\r\n      }\r\n    }\r\n    run()\r\n  })\r\n}\r\n\r\nFetch2.prototype.URLParams = URLParams\r\n\r\n// for node-fetch\r\nFetch2.prototype.init = function (fetch, formData) {\r\n  Fetch = fetch\r\n  FormData = formData\r\n}\r\n\r\nFetch2.prototype.Fetch2 = Fetch2\r\n\r\nFetch2.prototype.get = function (uri, options) {\r\n  return this.fetch(uri, 'GET', options)\r\n}\r\n\r\nFetch2.prototype.post = function (uri, options) {\r\n  return this.fetch(uri, 'POST', options)\r\n}\r\n\r\nFetch2.prototype.put = function (uri, options) {\r\n  return this.fetch(uri, 'PUT', options)\r\n}\r\n\r\nFetch2.prototype.delete = function (uri, options) {\r\n  return this.fetch(uri, 'DELETE', options)\r\n}\r\n\r\nFetch2.prototype.head = function (uri, options) {\r\n  return this.fetch(uri, 'HEAD', options)\r\n}\r\n\r\nFetch2.prototype.patch = function (uri, options) {\r\n  return this.fetch(uri, 'PATCH', options)\r\n}\r\n\r\nvar fetch2 = new Fetch2()\r\n\r\nexport default fetch2\r\n"],"names":["isOriginObject","obj","constructor","Date","HTMLElement","Blob","File","isArr","val","Object","prototype","toString","call","ObjTree","arr","key","babelHelpers.typeof","push","label","child","ObjTreePaths","tree","path","i","URLParams","encode","paths","qs","join","encodeURI","url","params","indexOf","uri","split","replace","_self","self","_global","global","root","Fetch","fetch","FormData","Fetch2","request","fn","warn","interceptors","response","method","options","that","toUpperCase","body","isTransion","headers","stringify","opts","Promise","resolve","reject","res","length","v","run","interceptor","then","type","text","data","blob","arrayBuffer","buffer","json","catch","err","init","formData","get","post","put","delete","head","patch","fetch2"],"mappings":"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"}